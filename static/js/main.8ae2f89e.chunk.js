(this["webpackJsonpdimgai-pixel"]=this["webpackJsonpdimgai-pixel"]||[]).push([[0],[,,,,,,,,,,function(t,e,n){t.exports=n(23)},,,,,function(t,e,n){},function(t,e,n){},,,,function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),c=n(9),r=n.n(c),i=(n(15),n(1)),l=(n(16),n(2)),s=n(3),u=n.n(s),d=n(7);const h="USER_DATA";var f=function(t){let e=null;function n(){return new Promise((t,n)=>{if(!window.indexedDB)return void n();if(e)return void t(e);let a=indexedDB.open("DIMGAI-PIXEL",1);a.onerror=()=>{n()},a.onsuccess=n=>{e=n.target.result,t(e)},a.onupgradeneeded=t=>{t.target.result.createObjectStore(h,{keyPath:"key"})}})}function a(){return(a=Object(d.a)(u.a.mark((function e(){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:return a=e.sent,e.abrupt("return",new Promise((e,n)=>{let o=a.transaction([h]).objectStore(h).get(t);o.onsuccess=()=>{o.result?e(o.result.data):n()},o.onerror=n}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function o(){return(o=Object(d.a)(u.a.mark((function e(a){var o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:return o=e.sent,e.abrupt("return",new Promise((e,n)=>{let c=o.transaction([h],"readwrite").objectStore(h).put({key:t,data:a});c.onerror=n,c.onsuccess=e}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{current:function(){return a.apply(this,arguments)},update:function(t){return o.apply(this,arguments)}}};const m=f("currentImage"),p=f("settings"),v={PENCIL:"pencil",ERASER:"eraser",SELECTION:"selection"};function O(t,e){const n=function t(e,n){switch(n.type){case"INIT":return Object(l.a)({},e,{initiated:!0});case"TOOL":return n.value&&Object.values(v).includes(n.value.type)?Object(l.a)({},e,{tool:Object(l.a)({},e.tool,{},n.value)}):e;case"ZOOM_IN":return t(e,{type:"ZOOM_TO",value:e.zoom+1});case"ZOOM_OUT":return t(e,{type:"ZOOM_TO",value:e.zoom-1});case"ZOOM_TO":return n.value>=1?Object(l.a)({},e,{zoom:n.value}):e;case"SET_HISTORY":return Object(l.a)({},e,{history:{capacity:e.history.capacity,index:n.value.length-1,items:n.value}});case"ADD_HISTORY":{const t=e.history.capacity,a=e.history.index,o=e.history.items;return Object(l.a)({},e,{history:{capacity:t,index:Math.min(a+1,t-1),items:[...o.slice(0,a+1),n.value].slice(-t)}})}case"UNDO":return e.history.index<=0?e:Object(l.a)({},e,{history:Object(l.a)({},e.history,{index:e.history.index-1})});case"REDO":return e.history.items.length<=e.history.index+1?e:Object(l.a)({},e,{history:Object(l.a)({},e.history,{index:e.history.index+1})});case"CLEAR_CANVAS":return Object(l.a)({},t(e,{type:"SET_HISTORY",value:[null]}),{canvas:null});case"RESIZE_CANVAS":{const t=n.value&&n.value.width&&n.value.height?n.value:null;return Object(l.a)({},e,{canvas:t})}default:return e}}(t,e);return function(t,e,n){if(t.initiated&&t!==e)switch(n.type){case"SET_HISTORY":case"ADD_HISTORY":m.update(e.history.items[e.history.index]);break;case"TOOL":case"CLEAR_CANVAS":case"RESIZE_CANVAS":p.update({canvas:e.canvas,tool:e.tool})}}(t,n,e),n}const g={palette:["#000000","#5f5750","#82759a","#c0c1c5","#fff0e7","#7d2953","#ff074e","#ff76a6","#a95238","#ffa108","#feeb2c","#ffcaa8","#008551","#00e339","#222e53","#2cabfe"],tool:{type:v.PENCIL,size:1,color:0},zoom:5,canvas:null,history:{capacity:10,index:0,items:[null]},initiated:!1};function y(t,e,n,a){return[t-n,e-a]}function b(t){return Math.hypot(...t)}function E(){let t=Object(a.useState)(null),e=Object(i.a)(t,2),n=e[0],o=e[1],c=Object(a.useRef)();return Object(a.useEffect)(()=>{const t=c.current;t.addEventListener("touchstart",t=>{o(e=>function(t,e){if(2===t.targetTouches.length){const e=Object(i.a)(t.targetTouches,2),n=e[0],a=e[1],o={x:(n.clientX+a.clientX)/2,y:(n.clientY+a.clientY)/2,distance:b(y(n.clientX,n.clientY,a.clientX,a.clientY))};return{start:o,current:o,movement:[0,0],scale:1}}return e}(t,e))}),t.addEventListener("touchmove",t=>{o(e=>function(t,e){if(e&&2===t.targetTouches.length){const n=Object(i.a)(t.targetTouches,2),a=n[0],o=n[1],c={x:(a.clientX+o.clientX)/2,y:(a.clientY+o.clientY)/2,distance:b(y(a.clientX,a.clientY,o.clientX,o.clientY))},r=c.distance/e.start.distance,s=r>1?Math.max(1,r-.5):Math.min(1,r+.5);return Object(l.a)({},e,{current:c,movement:[c.x-e.start.x,c.y-e.start.y],scale:s})}return e}(t,e))}),t.addEventListener("touchend",t=>{o(t=>null)})},[c]),[n,c]}var T=n(5),w=n(6),j=n.n(w);n(20);function C(){return document.body.clientWidth!==window.innerWidth}function x(t){return t.type.startsWith("touch")&&"stylus"===t.targetTouches[0].touchType}function S(t){if(!t)return;t.getContext("2d").clearRect(0,0,t.width,t.height)}var I=function(t){const e=Object(a.useState)(!1),n=Object(i.a)(e,2),c=n[0],r=n[1],s=Object(a.useRef)(null),u=Object(a.useRef)(null),d=Object(a.useRef)(null),h=Object(a.useRef)({lastPoint:null,startPoint:null,type:t.tool}),f=Object(a.useState)([]),m=Object(i.a)(f,2),p=m[0],O=m[1];function g(e){const n=d.current.getContext("2d");n.setLineDash([6,3]),n.strokeStyle="rgba(0, 0, 0, 0.4)",n.lineWidth=2,0===e.width&&0===e.height||n.strokeRect(e.xTarget*t.zoom,e.yTarget*t.zoom,e.width*t.zoom,e.height*t.zoom)}function y(){u.current.getContext("2d").drawImage(s.current,0,0);const e=u.current.toDataURL();e!==t.data&&t.onCanvasUpdate(e),S(s.current)}function b(e){if(C())return;if(e.type.startsWith("touch")){const t=x(e);if(r(c||t),c&&!t)return}else e.preventDefault();S(d.current);let n=e.targetTouches?e.targetTouches[0].clientX:e.clientX,a=e.targetTouches?e.targetTouches[0].clientY:e.clientY;h.current.lastPoint=null;const o=s.current.getBoundingClientRect();I((n-o.left)/t.zoom,(a-o.top)/t.zoom,1)}function E(e){if(!C()){if(e.preventDefault(),t.tool!==v.SELECTION){u.current.getContext("2d").drawImage(s.current,0,0),y(),S(s.current)}else{var n,a=Object(T.a)(p);try{for(a.s();!(n=a.n()).done;){let t=n.value;u.current.getContext("2d").clearRect(t.x,t.y,t.width,t.height)}}catch(o){a.e(o)}finally{a.f()}}h.current.lastPoint=null,h.current.startPoint=null,h.current.active_selection=null}}function w([e,n]){return[Math.min(t.width,Math.max(0,e)),Math.min(t.height,Math.max(0,n))]}function I(e,n,a){if(t.tool===v.SELECTION&&!j.a.isLength(h.current.active_selection)){var o,c=Object(T.a)(p.entries());try{for(c.s();!(o=c.n()).done;){let t=Object(i.a)(o.value,2),a=t[0],c=t[1];if(e>c.xTarget&&e<c.xTarget+c.width&&n>c.yTarget&&n<c.yTarget+c.height){h.current.active_selection=a;break}}}catch(l){c.e(l)}finally{c.f()}}e=Math.floor(e),n=Math.floor(n);let r=[[e,n]];if(h.current.lastPoint){let t=Object(i.a)(h.current.lastPoint,2),a=t[0],o=t[1],c=a,l=o,s=Math.max(Math.abs(e-a),Math.abs(n-o)),u=(e-a)/s,d=(n-o)/s;for(;s>0;)c+=u,l+=d,r.push([Math.round(c),Math.round(l)]),s--}else if(h.current.startPoint=[e,n],j.a.isLength(h.current.active_selection)){const t=p[h.current.active_selection];h.current.delta=[t.xTarget-e,t.yTarget-n]}else t.tool===v.SELECTION&&y(),O([]);switch(t.tool){case v.PENCIL:{const e=s.current.getContext("2d");e.fillStyle=t.color,r.forEach(([t,n])=>e.fillRect(t,n,a,a));break}case v.ERASER:{const t=u.current.getContext("2d");r.forEach(([e,n])=>t.clearRect(e,n,a,a));break}case v.SELECTION:if(j.a.isLength(h.current.active_selection))O(t=>{let a=t.pop()||{};return a.xTarget=h.current.delta[0]+e,a.yTarget=h.current.delta[1]+n,[...t,a]});else{const t=w(h.current.startPoint),a=Object(i.a)(t,2),o=a[0],c=a[1],r=w([e,n]),l=Object(i.a)(r,2),s=l[0],d=l[1];O(t=>{let e=t.pop()||{};return e.x=Math.min(o,s),e.y=Math.min(c,d),e.xTarget=e.x,e.yTarget=e.y,e.width=Math.abs(s-o),e.height=Math.abs(d-c),0!==e.width&&0!==e.height&&(e.data=u.current.getContext("2d").getImageData(o,c,s-o,d-c)),[...t,e]})}}h.current.lastPoint=[e,n]}Object(a.useEffect)(()=>{const e=u.current.getContext("2d");if(t.data){let n=new Image;n.onload=()=>{S(u.current),e.drawImage(n,0,0)},n.src=t.data}else S(u.current)},[t.data]),Object(a.useEffect)(()=>{S(d.current),S(s.current);const t=s.current.getContext("2d");var e,n=Object(T.a)(p);try{for(n.s();!(e=n.n()).done;){let n=e.value;0!==n.width&&0!==n.height&&t.putImageData(n.data,n.xTarget,n.yTarget),g(n)}}catch(a){n.e(a)}finally{n.f()}},[p]);const R={width:t.width,height:t.height},N={width:"".concat(t.width*t.zoom,"px"),height:"".concat(t.height*t.zoom,"px")},M={transform:"".concat("translate(-50%, -50%)"," translate(").concat(t.pos[0],"px, ").concat(t.pos[1],"px)")};return o.a.createElement("div",{className:"Artboard",onMouseDown:b,onMouseMove:function(e){if(1!==e.buttons)return;if(!h.current.lastPoint)return;e.preventDefault();const n=s.current.getBoundingClientRect();I((e.clientX-n.left)/t.zoom,(e.clientY-n.top)/t.zoom,1)},onMouseUp:E,onTouchStart:b,onTouchMove:function(e){if(1!==e.touches.length||C())return;if(c&&!x(e))return;if(!h.current.lastPoint)return;const n=s.current.getBoundingClientRect(),a=e.touches[0];I((a.clientX-n.left-window.scrollX)/t.zoom,(a.clientY-n.top-window.scrollY)/t.zoom,1)},onTouchEnd:E},o.a.createElement("div",{className:"canvas",style:Object(l.a)({},N,{},M)},o.a.createElement("canvas",Object.assign({ref:u},R,{style:N})),o.a.createElement("canvas",Object.assign({id:"drawing",ref:s},R,{style:N})),o.a.createElement("canvas",{id:"selection",ref:d,width:t.width*t.zoom,height:t.height*t.zoom})))};n(21),n(22);function R(t){return o.a.createElement("div",{className:t.selected?"color selected":"color",style:{backgroundColor:t.value},onClick:()=>{t.handleColorUpdate(t.value)}},t.selected&&o.a.createElement("div",null))}var N=function(t){const e=t.colors;return o.a.createElement("div",{className:"palette"},e.map(e=>o.a.createElement(R,{key:e,value:e,selected:t.color===e,handleColorUpdate:t.onColorUpdate})))};function M(t){let e=Object(a.useState)(!1),n=Object(i.a)(e,2),c=n[0],r=n[1],l=Object(a.useRef)();function s(t){switch(t.type){case"touchstart":r(!0);break;case"touchend":case"touchcancel":{const e=t.changedTouches[0],n=document.elementFromPoint(e.pageX-window.scrollX,e.clientY-window.scrollY);n&&l.current.contains(n)&&n.click();break}case"click":r(t=>!t)}}return o.a.createElement("div",{className:"Toolbox"},o.a.createElement("div",{className:"anchor ".concat(t.tool),onTouchStart:s,onTouchMove:s,onTouchEnd:s,onTouchCancel:s,onClick:s,style:{backgroundColor:t.tool===v.PENCIL?t.color:null}}),o.a.createElement("div",{ref:l,className:"tools ".concat(c?"visible":"hidden"),onClick:()=>r(!1)},o.a.createElement("button",{onClick:t.clear},"Clear"),o.a.createElement("button",{onClick:()=>t.setTool(v.ERASER),disabled:t.tool===v.ERASER},"Eraser"),o.a.createElement("button",{onClick:()=>t.setTool(v.SELECTION),disabled:t.tool===v.SELECTION},"Selection"),o.a.createElement(N,{colors:t.palette,color:t.color,onColorUpdate:t.setColor})))}var k=function(){const t=function(){const t=Object(a.useReducer)(O,g),e=Object(i.a)(t,2),n=e[0],o=e[1];Object(a.useEffect)(()=>{Promise.all([m.current(),p.current()]).then(t=>{const e=Object(i.a)(t,2),n=e[0],a=e[1];o({type:"SET_HISTORY",value:[n]}),o({type:"RESIZE_CANVAS",value:a.canvas}),o({type:"TOOL",value:a.tool}),o({type:"INIT"})}).catch(()=>{o({type:"INIT"})})},[]);const c={setColor:t=>{let e=n.palette.indexOf(t);-1===e&&(e=t),o({type:"TOOL",value:{type:v.PENCIL,color:e}})},setTool:t=>{o({type:"TOOL",value:{type:t}})},addHistory:t=>{o({type:"ADD_HISTORY",value:t})}};return[n,o,c,{get canRedo(){return n.history.index<n.history.items.length-1},get canUndo(){return n.history.index>0},get canvasData(){return n.history.items[n.history.index]},get color(){return n.palette[n.tool.color]||n.tool.color},get tool(){return n.tool.type},get width(){return n.canvas?n.canvas.width:0},get height(){return n.canvas?n.canvas.height:0}}]}(),e=Object(i.a)(t,4),n=e[0],c=e[1],r=e[2],l=e[3];let s=Object(a.useState)([0,0]),u=Object(i.a)(s,2),d=u[0],h=u[1];Object(a.useEffect)(()=>{if(n.initiated&&null===n.canvas){let t=window.prompt("Enter canvas size","64 64"),e=t?t.split(" "):[64,64];c({type:"RESIZE_CANVAS",value:{width:parseInt(e[0]),height:parseInt(e[1])}})}},[n.initiated,n.canvas]);let f=E(),y=Object(i.a)(f,2),b=y[0],T=y[1],w=Object(a.useState)(null),j=Object(i.a)(w,2),C=j[0],x=j[1];return Object(a.useEffect)(()=>{if(!b)return void x(null);if(b.start===b.current)return void x({pos:d,zoom:n.zoom});h([C.pos[0]+b.movement[0],C.pos[1]+b.movement[1]]);const t=Math.trunc(b.scale*C.zoom);t!==n.zoom&&c({type:"ZOOM_TO",value:t})},[b]),o.a.createElement("div",{className:"App",ref:T},o.a.createElement(I,{width:l.width,height:l.height,zoom:n.zoom,color:l.color,tool:l.tool,onCanvasUpdate:function(t){r.addHistory(t)},data:l.canvasData,pos:d}),o.a.createElement("div",{className:"top-left"},o.a.createElement("button",{disabled:!l.canUndo,onClick:()=>c({type:"UNDO"})},"Undo")),o.a.createElement("div",{className:"top-right"},o.a.createElement("button",{disabled:!l.canRedo,onClick:()=>c({type:"REDO"})},"Redo")),o.a.createElement("div",{className:"bottom-left"},o.a.createElement(M,{tool:l.tool,color:l.color,palette:n.palette,clear:function(){window.confirm("Clear the canvas?")&&c({type:"CLEAR_CANVAS"})},setTool:r.setTool,setColor:r.setColor}),o.a.createElement("button",{onClick:()=>{c({type:"ZOOM_OUT"})}},"-"),o.a.createElement("button",{onClick:()=>{c({type:"ZOOM_IN"})}},"+")),o.a.createElement("div",{className:"bottom-right"}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(k,null),document.getElementById("root"));let L=0;document.addEventListener("touchend",t=>{t.timeStamp-L<=350&&t.preventDefault(),L=t.timeStamp},!1),document.addEventListener("gesturestart",t=>{t.preventDefault()},!1),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}],[[10,1,2]]]);
//# sourceMappingURL=main.8ae2f89e.chunk.js.map